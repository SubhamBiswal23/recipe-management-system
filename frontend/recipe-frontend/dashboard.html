<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Recipe System</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <h2>üç≥ Recipe System</h2>
            <div class="nav-menu">
                <a href="dashboard.html" class="active">Home</a>
                <a href="favorites.html">Favorites</a>
                <a href="profile.html">Profile</a>
                <a href="#" id="logoutBtn">Logout</a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="welcome">
            <h1>Welcome, <span id="userName">User</span>!</h1>
            <p>Discover amazing recipes</p>
        </div>
        
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="Search for recipes...">
            <button onclick="searchRecipes()" class="btn">Search</button>
        </div>
        
        <div id="loading" class="loading" style="display: none;">Loading recipes...</div>
        
        <div class="recipe-grid" id="recipeGrid"></div>
    </div>
    
    <script>
        // Check if user is logged in
        const user = JSON.parse(localStorage.getItem('user'));
        if (!user) {
            window.location.href = 'login.html';
        } else {
            document.getElementById('userName').textContent = user.username;
        }
        
        // Logout
        document.getElementById('logoutBtn').addEventListener('click', function(e) {
            e.preventDefault();
            localStorage.clear();
            window.location.href = 'index.html';
        });
        
        // Load random recipes on page load
        window.addEventListener('load', loadRandomRecipes);
        
        async function loadRandomRecipes() {
            showLoading(true);
            try {
                const response = await fetch('http://localhost:8080/api/recipes/random?number=12');
                const data = await response.json();
                displayRecipes(data.recipes);
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('recipeGrid').innerHTML = '<p>Error loading recipes</p>';
            }
            showLoading(false);
        }
        
        async function searchRecipes() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) {
                alert('Please enter a search term');
                return;
            }
            
            showLoading(true);
            try {
                const response = await fetch(`http://localhost:8080/api/recipes/search?query=${query}&number=12`);
                const data = await response.json();
                displayRecipes(data.results);
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('recipeGrid').innerHTML = '<p>Error searching recipes</p>';
            }
            showLoading(false);
        }
        
        function displayRecipes(recipes) {
            const grid = document.getElementById('recipeGrid');
            
            if (!recipes || recipes.length === 0) {
                grid.innerHTML = '<p>No recipes found</p>';
                return;
            }
            
            grid.innerHTML = '';
            
            recipes.forEach(recipe => {
                const card = document.createElement('div');
                card.className = 'recipe-card';
                card.innerHTML = `
                    <img src="${recipe.image}" alt="${recipe.title}">
                    <div class="recipe-info">
                        <h3>${recipe.title}</h3>
                        <p>‚è±Ô∏è ${recipe.readyInMinutes || 'N/A'} min</p>
                        <p>üçΩÔ∏è ${recipe.servings || 'N/A'} servings</p>
                        <button onclick="viewRecipe(${recipe.id})" class="btn-small">View Recipe</button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }
        
        function viewRecipe(recipeId) {
            window.location.href = `recipe-detail.html?id=${recipeId}`;
        }
        
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }
    </script>
</body>
</html>